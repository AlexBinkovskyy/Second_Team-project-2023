{"version":3,"file":"commonHelpers.js","sources":["../src/js/shopping-cart.js","../src/js/cartForm.js"],"sourcesContent":["import { getProdByIDWithParams } from './query';\nimport icons from '../images/sprite.svg';\nimport { getCartItems } from './localStorage';\nimport {\n  addProductToCart,\n  setEmailToOrderInfo,\n  removeAllProductsFromCart,\n  removeProductFromCart,\n  updateProductInCart,\n} from './workWithCart';\n\nconst list = document.querySelector('.js-cart-list');\nconst formInput = document.querySelector('.cart-form-input');\nconst summ = document.querySelector('.js-total-summ');\nconst cartNumbersList = document.querySelectorAll('.js-cart-numbers');\nconst clearOrderBtn = document.querySelector('.js-clear-order-btn');\n\nconst cartBox = document.querySelector('.js-cart-box');\nconst emptyCart = document.querySelector('.js-empty-cart');\n\n// setEmailToOrderInfo('p@gmail.com');\nlet totalSumm = 0;\n\nlet arrCart = getCartItems();\nlet listFromServer = null;\n\ndrawCartPage();\n\nlist.addEventListener('click', e => {\n  if (e.target.classList.contains('delete-btn')) {\n    let parent = e.target.closest('.selectedProduct');\n    // console.log(parent);\n    removeProductFromCart(parent.dataset.id);\n\n    const index = arrCart.products.findIndex((product) => product.id === parent.dataset.id)\n    console.log(\"index\", index);\n    if (index !== -1) {\n      arrCart.products.splice(index, 1);\n      listFromServer.splice(index, 1)\n    }\n    console.log(arrCart);\n    console.log(listFromServer);\n    // drawCartPage();\n    updateCartPage();\n  }\n});\n\nclearOrderBtn.addEventListener('click', () => {\n  removeAllProductsFromCart();\n  arrCart.products = [];\n  listFromServer = [];\n  updateCartPage();\n});\n\nasync function drawCartPage() {\n  //масив з localStorage\n  arrCart = getCartItems();\n  // console.log(arrCart);\n\n  summ.textContent = '$0';\n\n  const amountElements = arrCart.products.length;\n  switchSections(amountElements);\n\n  if (amountElements) {\n    list.innerHTML = '';\n    //масив з Серверу\n    const originProductList = await getCartProducts(arrCart.products);\n    listFromServer = originProductList;\n    console.log(listFromServer);\n    // console.log(originProductList);\n\n    cartNumbersUpdate(cartNumbersList, amountElements);\n    // console.log(cartBox);\n    spawnCardProducts(originProductList);\n    summ.textContent = '$' + getTotalSumm(originProductList).toFixed(2);\n  }\n  formInput.value = arrCart.email;\n}\n\nasync function updateCartPage() {\n  arrCart = getCartItems();\n  console.log(arrCart);\n\n  const amountElements = arrCart.products.length;\n  switchSections(amountElements);\n\n  if (amountElements) {\n    // console.log(1, listFromServer);\n    // console.log(2, arrCart);\n    \n    summ.textContent = '$' + getTotalSumm(listFromServer).toFixed(2);\n    list.innerHTML = '';\n    spawnCardProducts(listFromServer);\n  }\n  // console.log(2, listFromServer);\n  cartNumbersUpdate(cartNumbersList, amountElements);\n}\n\n\nfunction spawnCardProducts(products) {\n  generateCardListMarkup(products, createCartProductMarkup).then(result => {\n    list.insertAdjacentHTML('beforeend', result);\n  });\n}\n\n/*  Параметри:\n      1.productList - масив з продуктами      \n        [{\n          id: '640c2dd963a319ea671e383b',\n          amount: 1,\n        }]\n\n      2.createElementMarkupFunc - Функція, що створює потрібну вам розмітку елемента.\n\n    Повертає html розмітку продуктів\n===================================================================================== */\nasync function generateCardListMarkup(productList, createElementMarkupFunc) {\n  return productList\n    .map(product => {\n      totalSumm += product.price;\n      return createElementMarkupFunc(product);\n    })\n    .join('');\n}\n\n/*  Параметри:\n      1.productList - масив з продуктами      \n        [{\n          id: '640c2dd963a319ea671e383b',\n          amount: 1,\n        }]\n\n    Повертає масив даних з продуктів\n===================================================================================== */\nasync function getCartProducts(productList) {\n  return await Promise.all(\n    productList.map(({ id }) =>\n      getProdByIDWithParams(id).then(rqst => rqst.data)\n    )\n  );\n}\n\n// створення карттки в кошику\nfunction createCartProductMarkup(product) {\n  const { _id, name, img, category, price, size } = product;\n  let amount = null;\n  try {\n    amount = arrCart.products[arrCart.products.findIndex(p => p.id === _id)].amount;\n  } catch (error) {\n    console.log(error);\n    return \"\"\n  }\n  \n  const cleanedCategory = category.replace(/_/g, ' ');\n\n  return `\n    <li class=\"selectedProduct\" data-id=${_id}>\n      <div class=\"product-picture\">\n          <img src=\"${img}\" alt=\"${name}\" class=\"\" loading=\"lazy\" />\n      </div>\n\n      <div class=\"product-info-container\">\n\n      <div class=\"info-header\">\n        <h2 class=\"product-name\">${name}</h2>\n        <button class=\"delete-btn\">\n\n          <svg class=\"\" width=\"11.25\" height=\"11.25\">\n\n            <use href=\"${icons}#icon-Cross_close\"></use>\n          </svg>\n        </button>\n      </div>\n\n      <div class=\"product-info\">\n        <p class=\"info-quality-category\"> Category: <span class=\"info-value\">${cleanedCategory}</span></p>\n        <p class=\"info-quality\"> Size:<span class=\"info-value\">${size}</span></p>\n      </div>\n        <div class=\"price\">$\n          <span>${price}</span>\n        </div>\n      </div>\n      <div class=\"counter-container\">\n            <button class=\"counter-btn\" type=\"button\" data-action=\"decrement\">\n                -\n            </button>\n            <span class=\"counter-value data-counter\">${amount}</span>\n            <button class=\"counter-btn\" type=\"button\" data-action=\"increment\">\n                +\n            </button>\n        </div>\n  </li>`;\n}\n\n/**\n  |============================\n  | ЛІЧИЛЬНИК\n  |============================\n*/\n\nlet counter;\n\nlist.addEventListener('click', function (event) {\n  const obj = getCartItems();\n  let thisCard = '';\n  let thisProductIndex = '';\n\n  // Перевірка кліку сурово по кнопкам + або -\n  if (\n    event.target.dataset.action === 'increment' ||\n    event.target.dataset.action === 'decrement'\n  ) {\n    thisCard = event.target.closest('.selectedProduct');\n    thisProductIndex = arrCart.products.findIndex(\n      product => product.id === thisCard.dataset.id\n    );\n    // console.log(thisProductIndex);\n\n    // Найшли обгортку лічильника\n    const counterContainer = event.target.closest('.counter-container');\n\n    // Найшли значення лічильника\n    counter = counterContainer.querySelector('.counter-value');\n  } else {\n    return;\n  }\n\n  // Перевірка чи елемент являється кнопкою плюс\n  if (event.target.dataset.action === 'increment') {\n    // Змінює текст в лічильнику, збільшує на 1\n\n    counter.innerHTML = ++counter.innerHTML;\n  }\n\n  // Перевірка чи елемент являється кнопкою мінус\n  if (event.target.dataset.action === 'decrement') {\n    // Перевірка щоб лічильник був більше або рівний 1\n    if (parseInt(counter.innerHTML) > 1) {\n      // Змінює текст в лічильнику, зменьшує на 1\n      counter.innerHTML = --counter.innerHTML;\n    }\n  }\n\n  updateProductInCart(obj.products[thisProductIndex].id, counter.innerHTML);\n\n  updateCartPage()\n});\n\n/**\n  |============================\n  | ДОДАТКОВО ВИДАЛИТЬ ПРОДУКТ ЯКЩО ВІН БУДЕ МЕНШЕ 1\n  |============================\n*/\n// else if (parseInt(counter.innerHTML) === 1) {\n//       // Якщо лічильник дорівнює 1, видалити товар з кошика\n//       let parentEl = event.target.closest('.selectedProduct');\n//       removeProductFromCart(parentEl.dataset.id);\n//       drawCartPage();\n//     }\n\n/**\n  |============================\n  | \n  |============================\n*/\nfunction switchSections(bool) {\n  objHide(cartBox, emptyCart);\n  if (bool) {\n    objShow(cartBox);\n  } else {\n    objShow(emptyCart);\n  }\n}\n\nfunction objShow(...objs) {\n  objs.forEach(obj => {\n    obj.classList.remove('hiden');\n  });\n}\n\nfunction objHide(...objs) {\n  objs.forEach(obj => {\n    obj.classList.add('hiden');\n  });\n}\n\nfunction cartNumbersUpdate(objs, number) {\n  objs.forEach(obj => {\n    obj.textContent = number;\n  });\n}\n\nfunction getTotalSumm(products) {\n  return products.reduce((sum, product) => {\n    return (\n      sum + product.price * arrCart.products[arrCart.products.findIndex(p => p.id === product._id)].amount\n    );\n  }, 0);\n}\n","import { getCartItems } from \"./localStorage\";\nimport { setEmailToOrderInfo } from \"./workWithCart\";\n// import { postOrder } from \"./query\";\n\nconst form = document.querySelector('.cart-form');\nconst modalCloseBtn = document.querySelector('.js-modal-close');\nconst modal = document.querySelector('.cart-modal-bg');\n\nconsole.log(\"Hello\");\n// console.log(\"Modal js\");\n\nform.addEventListener('submit', (e) => {\n  e.preventDefault();\n  setEmailToOrderInfo(form.elements['email'].value);\n\n  const order = getCartItems();\n  // console.log(order);\n  // postOrder(order);  \n  modalOpen();\n});\nmodalCloseBtn.addEventListener('click', modalClose);\n\nfunction modalOpen() {  \n  modal.classList.remove('hiden');\n}\nfunction modalClose() {\n  modal.classList.add('hiden');\n}\n"],"names":["list","formInput","summ","cartNumbersList","clearOrderBtn","cartBox","emptyCart","totalSumm","arrCart","getCartItems","listFromServer","drawCartPage","e","parent","removeProductFromCart","index","product","updateCartPage","removeAllProductsFromCart","amountElements","switchSections","originProductList","getCartProducts","cartNumbersUpdate","spawnCardProducts","getTotalSumm","products","generateCardListMarkup","createCartProductMarkup","result","productList","createElementMarkupFunc","id","getProdByIDWithParams","rqst","_id","name","img","category","price","size","amount","p","error","cleanedCategory","icons","counter","event","obj","thisCard","thisProductIndex","updateProductInCart","bool","objHide","objShow","objs","number","sum","form","modalCloseBtn","modal","setEmailToOrderInfo","modalOpen","modalClose"],"mappings":"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"}